USE MASTER
DROP DATABASE ESPORTS
GO

IF DB_ID('ESPORTS') IS NOT NULL
BEGIN
    ALTER DATABASE ESPORTS
    SET SINGLE_USER
    WITH ROLLBACK IMMEDIATE
   
    DROP DATABASE ESPORTS
END

CREATE DATABASE ESPORTS
GO

USE ESPORTS
GO

CREATE TABLE CLUB (
	IDCLUB NVARCHAR(10) PRIMARY KEY NOT NULL,
	NOMBRE nvarchar(50) NOT NULL
	)
GO

INSERT INTO CLUB (IDCLUB, NOMBRE) VALUES
	('G2', 'G2 ESPORTS'), 
	('FNC', 'FNATIC')
GO

CREATE TABLE AFILIADOS(
	IDAFILIADO int IDENTITY(1,1) PRIMARY KEY NOT NULL,
	NOMBRE nvarchar(25) NOT NULL,
	FECHAAF nvarchar(25) NOT NULL,
	IDCLUB NVARCHAR(10) REFERENCES CLUB (IDCLUB)
	)
GO

INSERT INTO AFILIADOS (NOMBRE, FECHAAF, IDCLUB) VALUES
	('Donovan', '10/10/2019', 'G2'), 
	('xPeke', '17/08/2018', 'FNC')
GO


CREATE TABLE PATROCINIOS(
	IDPATROCINIO int IDENTITY(1,1) PRIMARY KEY NOT NULL,
	NOMBRE nvarchar(25) NOT NULL,
	PAGO MONEY NOT NULL,
	IDCLUB NVARCHAR(10) REFERENCES CLUB(IDCLUB)
	)
GO

INSERT INTO PATROCINIOS (NOMBRE, PAGO, IDCLUB) VALUES
	('REDBULL', 2000, 'G2'), 
	('BMW', 2500, 'G2'),
	('LOGITECH', 1950, 'FNC')
GO


CREATE TABLE TROFEOS(
	IDTROFEO int IDENTITY(1,1) PRIMARY KEY NOT NULL,
	NOMBRE nvarchar(50) NOT NULL,
	JUEGO nvarchar(50) NOT NULL,
	IDCLUB NVARCHAR(10) REFERENCES CLUB(IDCLUB)
	)
GO

INSERT INTO TROFEOS (NOMBRE, JUEGO, IDCLUB) VALUES
	('WORLD CHAMPION', 'LEAGUE OF LEGENDS', 'G2'), 
	('EUROPE CHAMPION', 'RAINBOW SIX SIEGE', 'G2'),
	('SPANISH CHAMPION', 'WORLD OF WARCRAFT', 'FNC')
GO

CREATE TABLE PROYECTOS(
	IDPROYECTOS int IDENTITY(1,1) PRIMARY KEY NOT NULL,
	DESCRIPCION nvarchar(50) NOT NULL,
	IDCLUB NVARCHAR(10) REFERENCES CLUB(IDCLUB)
	)
GO

INSERT INTO PROYECTOS (DESCRIPCION, IDCLUB) VALUES
	('Contratar nuevos jugadores', 'G2'), 
	('Contratar nuevos entrenadores', 'FNC')
GO


CREATE TABLE ENTRENADORES(
	IDENTRENADOR int IDENTITY(1,1) PRIMARY KEY NOT NULL,
	NOMBRE nvarchar(25) NOT NULL,
	SALARIO MONEY NOT NULL,
	IDCLUB NVARCHAR(10) REFERENCES CLUB(IDCLUB)
	)
GO

INSERT INTO ENTRENADORES (NOMBRE, SALARIO, IDCLUB) VALUES
	('Alan', 1300, 'G2'), 
	('Ernesto', 1150, 'FNC')
GO


CREATE TABLE JUGADORES(
	IDJUGADOR int IDENTITY(1,1) PRIMARY KEY NOT NULL,
	NOMBRE nvarchar(25) NOT NULL,
	SALARIO MONEY NOT NULL
	)
GO

INSERT INTO JUGADORES (NOMBRE, SALARIO) VALUES
	('Iker', 2000), 
	('Antonio', 2300),
	('Jose', 1850),
	('Mikel', 1850)
GO


CREATE TABLE ENTRENA(
	IDENTRENADOR int REFERENCES ENTRENADORES (IDENTRENADOR) NOT NULL,
	IDJUGADOR INT REFERENCES JUGADORES (IDJUGADOR) NOT NULL,
	PRIMARY KEY (IDENTRENADOR, IDJUGADOR)
	)
GO

INSERT INTO ENTRENA (IDENTRENADOR, IDJUGADOR) VALUES
	(1, 1), 
	(1, 2),
	(2, 3)
GO

CREATE TABLE COMPETICIONES(
	IDCOMPETICION int IDENTITY(1,1) PRIMARY KEY NOT NULL,
	NOMBRE nvarchar(25) NOT NULL,
	FECHA NVARCHAR(25) NOT NULL,
	JUEGO NVARCHAR(25) NOT NULL
	)
GO

INSERT INTO COMPETICIONES (NOMBRE, FECHA, JUEGO) VALUES
	('WORLD CHAMPIONSHIP', '10/10/2017', 'LEAGUE OF LEGENDS'), 
	('EUROPE CHAMPIONSHIP', '02/05/2019', 'RAINBOW SIX SIEGE'),
	('SPANISH CHAMPIONSHIP', '17/03/2018', 'WORLD OF WARCRAFT')
GO


CREATE TABLE COMPETIR(
	IDJUGADOR int REFERENCES JUGADORES (IDJUGADOR) NOT NULL,
	IDCOMPETICION INT REFERENCES COMPETICIONES (IDCOMPETICION) NOT NULL,
	PRIMARY KEY (IDJUGADOR, IDCOMPETICION)
	)
GO

INSERT INTO COMPETIR (IDJUGADOR, IDCOMPETICION) VALUES
	(1, 1), 
	(2, 1),
	(3, 2),
	(4, 3)
GO

IF OBJECT_ID('SP_listarClubes') IS NOT NULL
	BEGIN
		DROP PROC SP_listarClubes
	END
GO
-- LISTAR
CREATE PROC SP_listarClubes
as
BEGIN
	SELECT IDCLUB AS ID
	,NOMBRE
	FROM CLUB
END
GO
-- CREAR
IF OBJECT_ID('SP_crearClub') IS NOT NULL
	BEGIN
		DROP PROC SP_crearClub
	END
GO

CREATE PROC SP_crearClub
@IDCLUB NVARCHAR(10),
@NOMBRE NVARCHAR(50)
as
BEGIN
	INSERT INTO CLUB([IDCLUB]
	,[NOMBRE])
	VALUES(@IDCLUB, @NOMBRE)
END
GO
EXEC SP_crearClub @IDCLUB = tst, @NOMBRE = test;
-- ACTUALIZAR
IF OBJECT_ID('SP_modificarClub') IS NOT NULL
	BEGIN
		DROP PROC SP_modificarClub
	END
GO

CREATE PROC SP_modificarClub
@IDCLUB NVARCHAR(10),
@NOMBRE NVARCHAR(50)
as
BEGIN
	UPDATE CLUB
	SET [NOMBRE] = @NOMBRE
	WHERE [IDCLUB] = @IDCLUB
END
GO
-- BORRAR
IF OBJECT_ID('SP_borrarClub') IS NOT NULL
	BEGIN
		DROP PROC SP_borrarClub
	END
GO

CREATE PROC SP_borrarClub
@IDCLUB NVARCHAR(10)
as
BEGIN
	DELETE FROM CLUB WHERE IDCLUB = @IDCLUB
END
GO